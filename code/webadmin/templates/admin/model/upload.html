{% extends layout_template %}


{% block main_content %}

{% include 'admin/model/_tabbar.html' %}
{% include('_include/message.html') %}

<div class="upload_form">
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="file" class="control-label">选择 xls 文件</label>
            <input type="file" id="file" name="file">
            <p class="help-block">上传的文件必须符合此资源的定义格式</p>
            <label class="checkbox">
                <input type="checkbox" name="update" value="yes" autocomplete="off" checked>更新到数据库
            </label>
            <p class="help-block">不勾选则仅作修改预览和数据检查</p>
        </div>
        <button type="submit" class="btn btn-primary">提交</button>
    </form>
</div>

{% if diff %}
<p>此 xls 修改情况如下</p>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th></th>
            <th>个数</th>
            <th>条目ID</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <th>新建条目</th>
        <td>{{ diff.create|length }}</td>
        <td>{{ diff.create }}</td>
    </tr>
    <tr>
        <th>更新条目</th>
        <td>{{ diff['update']|length }}</td>
        <td>{{ diff['update'] }}</td>
    </tr>
    <tr>
        <th>删除条目</th>
        <td>{{ diff.remove|length }}</td>
        <td>{{ diff.remove }}</td>
    </tr>
    </tbody>
</table>
{% endif %}

{% if errors is not undefined %}
{% if errors|length > 0 %}
<p class="text-error">此 xls 以下数据没有通过格式验证，请修复。</p>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>行</th>
            <th>列</th>
            <th>名称</th>
            <th>英文名</th>
            <th>类型</th>
            <th>所填的值</th>
        </tr>
    </thead>
    <tbody>
    {% for row, row_errors in errors.iteritems() %}
    {% for col, name, key, type, value in row_errors %}
    <tr>
        <td>{{ row }}</td>
        <td>{{ col }}({{ col|excel_col }})</td>
        <td>{{ name }}</td>
        <td>{{ key }}</td>
        <td>{{ type }}</td>
        <td>{{ value }}</td>
    </tr>
    {% endfor %}
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-success">此 xls 所有数据通过格式验证。</p>
{% endif %}
{% endif %}

{% endblock %}
